/* Author: GarRaptor
 * Description: Interface to the Entity Component System
 */

#pragma once

#include "coreECS/Common.h"
#include "coreECS/EntityStore.h"
#include "coreECS/ComponentStore.h"
#include "coreECS/Systems.h"

namespace ecs {

    EntityId getNewEntityId(const std::string &tag = "") {
        static EntityId entityId = 0;
        entity::EntityStore::getInstance()->addEntity(entityId, tag);
        return entityId++;
    }

    void rmEntity(EntityId entityID);

    template<typename T>
    void addComponent(EntityId entityId, T &component) {
        component.entityID = entityId;
        component::ComponentStore *componentStore = component::ComponentStore::getInstance();
        entity::EntityStore *entityStore = entity::EntityStore::getInstance();

        T *componentPtr = componentStore->addComponent<T>(component);

        if (componentPtr)
            entityStore->addComponent(entityId, T::ID(), componentPtr);
    }

    void registerSystem(SystemFunctionPtr callback, SystemRunType systemRunType) {
        system::Systems::getInstance()->addSystem(callback, systemRunType);
    }

    void run() {
        system::Systems::getInstance()->run();
    }

    void stop() {
        system::Systems::getInstance()->stop();
    }

    size_t numActive(const ComponentId &componentId) {
        return component::ComponentStore::getInstance()->active(componentId);
    }

    template<typename T>
    void rmComponent(ComponentId &name);

    template<typename T>
    T *getComponent(EntityId entityID) {
        return reinterpret_cast<T*>(entity::EntityStore::getInstance()->getComponent(entityID, T::ID()));
    }

    template<typename T>
    void activateComponent(EntityId entityID, ComponentId &name);

    template<typename T>
    void deactivateComponent(EntityId entityID, ComponentId &name);

// void addSystem(void (funcPtr)(void));
// void rmSystem(void (funcPtr)(void));
// void enableSystem(void (funcPtr)(void));
// void disableSystem(void (funcPtr)(void));

    template<typename T>
    T *getComponentList() {
        return component::ComponentStore::getInstance()->getComponentList<T>();
    }

    int *getEntityList(ComponentId *componentTuple);
// TODO: get ComponentList with list of entity IDs

};
